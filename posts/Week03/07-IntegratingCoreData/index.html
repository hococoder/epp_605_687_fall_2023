<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/posts/Week03/07-IntegratingCoreData"/><meta name="twitter:url" content="https://hococoder.com/posts/Week03/07-IntegratingCoreData"/><meta name="og:url" content="https://hococoder.com/posts/Week03/07-IntegratingCoreData"/><title>Week 3 - Integrating Core Data | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 3 - Integrating Core Data | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 3 - Integrating Core Data | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><header><div class="wrapper"><a class="site-name" href="/">Mobile Application Development for the iOS Platform</a><nav><ul><li><a href="/epp_605_687_spring_2023/posts/Intro/About Me">AboutMe</a></li><li><a href="/epp_605_687_spring_2023/posts/Intro/Example App">ExampleApp</a></li><li><a href="/epp_605_687_spring_2023/posts/Week00/00-Week00Overview">Week0</a></li><li><a href="/epp_605_687_spring_2023/posts/Week01/00-Week01Overview">Week1</a></li><li><a href="/epp_605_687_spring_2023/posts/Week02/00-Week02Overview">Week2</a></li><li><a href="/epp_605_687_spring_2023/posts/Week03/00-Week03Overview">Week3</a></li><li><a href="/epp_605_687_spring_2023/posts/Week04/00-Week04Overview">Week4</a></li><li><a href="/epp_605_687_spring_2023/posts/Week05/00-Week05Overview">Week5</a></li><li><a href="/epp_605_687_spring_2023/posts/Week06/00-Week06Overview">Week6</a></li><li><a href="/epp_605_687_spring_2023/posts/Week07/00-Week07Overview">Week7</a></li><li><a href="/epp_605_687_spring_2023/posts/Week08/00-Week08Overview">Week8</a></li><li><a href="/epp_605_687_spring_2023/posts/Week09/00-Week09Overview">Week9</a></li><li><a href="/epp_605_687_spring_2023/posts/Week10/00-Week10Overview">Week10</a></li><li><a href="/epp_605_687_spring_2023/posts/Week11/00-Week11Overview">Week11</a></li><li><a href="/epp_605_687_spring_2023/posts/Week12/00-Week12Overview">Week12</a></li><li><a href="/epp_605_687_spring_2023/posts/Week13/00-Week13Overview">Week13</a></li><li><a href="/epp_605_687_spring_2023/posts/Week14/00-Week14Overview">Week14</a></li></ul></nav></div></header><div class="wrapper"><h1>Week 3 - Integrating Core Data</h1><p style="float: left">Previous:  <A HREF="../06-NSManagedObjects/index.html">Making NSManagedObjects</A></p><p style="float: right">Next:  <A HREF="../08-StoringAndFetching/index.html" class="nextModule">Storing and Fetching</A></p><BR/><BR/><h2>So why "TeacherEntity" and not just "Teacher"?</h2><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_wxkc9usl?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_wxkc9usl&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><p>You may have noticed that I tagged on "Entity" onto the names of the Core Data entities. Why? Well, I already have a <code>Teacher</code> struct in the project - and I can't have 2 identically named items in the project. Plus, Core Data works with Classes, while what I have in place so far deals with structs - which is preferred where possible with Swift and SwiftUI. Is it a pain? You bet it is. I'm really hoping that future updates to Core Data will work a little bit better with SwiftUI down the road, but we're stuck with what we have right now. So, to that end, let's make some methods to convert between the 2 types. I'll use the <code>Teacher</code> based types here, but the other types work in a similar fashion. Let's extend the <code>Teacher</code> struct and add some new functionality.</p><p class="new"> 
The references to "ClassAssignmentsCoreDataModel.context" in the video have been replaced with the globally available "PersistenceController.shared.container.viewContext" property
</p><pre><code><span class="keyword">extension</span> <span class="type">Teacher</span> {
  
  <span class="keyword">func</span> convertToManagedObject() -&gt; <span class="type">TeacherEntity</span> {
    
    <span class="keyword">let</span> teacherEntity = <span class="type">TeacherEntity</span>(context: <span class="type">PersistenceController</span>.<span class="property">shared</span>.<span class="property">container</span>.<span class="property">viewContext</span>)
    teacherEntity.<span class="property">name</span> = <span class="keyword">self</span>.<span class="property">name</span>
    teacherEntity.<span class="property">email</span> = <span class="keyword">self</span>.<span class="property">email</span>
    teacherEntity.<span class="property">jhed</span> = <span class="keyword">self</span>.<span class="property">jhed</span>
    teacherEntity.<span class="property">imageName</span> = <span class="keyword">self</span>.<span class="property">imageName</span>
    teacherEntity.<span class="property">startDate</span> = <span class="keyword">self</span>.<span class="property">startDate</span>
    teacherEntity.<span class="property">highestDegree</span> = <span class="keyword">self</span>.<span class="property">highestDegree</span>.<span class="property">rawValue</span>
    teacherEntity.<span class="property">classesTaught</span> = <span class="type">NSSet</span>()
    teacherEntity.<span class="property">activelyTeaching</span> = <span class="type">NSSet</span>()
    teacherEntity.<span class="property">currentRating</span> = <span class="keyword">self</span>.<span class="property">currentRating</span>
    teacherEntity.<span class="property">affiliation</span> = <span class="keyword">self</span>.<span class="property">affiliation</span>
    <span class="keyword">return</span> teacherEntity
  }
  
  <span class="keyword">init</span>(teacherEntity: <span class="type">TeacherEntity</span>) {
    <span class="keyword">self</span>.<span class="property">name</span> = teacherEntity.<span class="property">name</span>!
    <span class="keyword">self</span>.<span class="property">email</span> = teacherEntity.<span class="property">email</span>!
    <span class="keyword">self</span>.<span class="property">jhed</span> = teacherEntity.<span class="property">jhed</span>!
    <span class="keyword">self</span>.<span class="property">imageName</span> = teacherEntity.<span class="property">imageName</span>!
    <span class="keyword">self</span>.<span class="property">startDate</span> = teacherEntity.<span class="property">startDate</span>!
    <span class="keyword">self</span>.<span class="property">highestDegree</span> = <span class="type">EdDegree</span>.<span class="keyword">init</span>(rawValue: teacherEntity.<span class="property">highestDegree</span>!)!
    <span class="keyword">var</span> tempClassesTaught: [<span class="type">Courses</span>] = []
    <span class="keyword">for</span> courseCl <span class="keyword">in</span> teacherEntity.<span class="property">classesTaught</span>!.allObjects <span class="keyword">as</span>! [<span class="type">CourseClassEntity</span>] {
      
      <span class="keyword">let</span> schoolClass = <span class="type">CourseClass</span>(courseClassEntity: courseCl)
      tempClassesTaught.<span class="call">append</span>(schoolClass.<span class="property">className</span>)
    }
    <span class="keyword">self</span>.<span class="property">classesTaught</span> = tempClassesTaught
    
    <span class="keyword">var</span> tempActivelyTeaching: [<span class="type">Courses</span>] = []
    <span class="keyword">for</span> courseCl <span class="keyword">in</span> teacherEntity.<span class="property">activelyTeaching</span>!.allObjects <span class="keyword">as</span>! [<span class="type">CourseClassEntity</span>] {
      
      <span class="keyword">let</span> schoolClass = <span class="type">CourseClass</span>(courseClassEntity: courseCl)
      tempActivelyTeaching.<span class="call">append</span>(schoolClass.<span class="property">className</span>)
    }
    <span class="keyword">self</span>.<span class="property">activelyTeaching</span> = tempActivelyTeaching
    
    <span class="keyword">self</span>.<span class="property">currentRating</span> = teacherEntity.<span class="property">currentRating</span>
    <span class="keyword">self</span>.<span class="property">affiliation</span> = teacherEntity.<span class="property">affiliation</span>!
  }
}
</code></pre><p>Let's look at the first method - <code>convertToManagedObject()</code>. This takes the struct and converts it into a <code>TeacherEntity</code> (which is a child of <code>NSManagedObject</code>). This is pretty straight forward - we can use the <code>TeacherEntity</code> constructor to initialize an instance, passing in the <code>context</code> from our <code>ClassAssignmentCoreDataModel</code> object, which we'll talk about next. The rest of the method is just assigning values and initializing the <code>NSSet</code>s for the <code>classesTaught</code> and <code>activelyTeaching</code> properties. Note here that I don't assign the relationships here - I just initialize the sets. This is because I don't know if the objects I wish to assign to these sets actually exist in the database yet, so I'll do this AFTER initialization.</p><p>The next method - a new initializer for the struct - takes in a <code>TeacherEntity</code> and builds the <code>Teacher</code> from that. This is the opposite case from above, and we're assuming here that the database is as complete and populated as we need it to be, so we can assign all the appropriate values. It's a bit of a syntactical mess to loop through the contents of the <code>NSSet</code> but it works - the <code>.allObjects</code> method is used to get the values of the set and those values are cast to the appropriate array for looping. Those entities are then used to populate the appropriate structs (The <code>CourseClass</code> struct, for example).</p><p>I've gone ahead and also made extension for the <code>CourseClassEntity</code> and <code>AssignmentEntity</code>, which work in a similar fashion.</p><h2>But... isn't that a lot just to use structs everywhere?</h2><p>A simpler way to attack this problem would be to use classes throughout the app for these types, instead of structs. Then, we could simply use the entities defined in the database schema, which underneath are classes. While I'm holding out that future updates to Core Data will better integrate with Swift, it hasn't happened yet.</p><p>So, to use classes from Core Data:</p><ul><li>Setup the schema as described earlier, but use the same names as the structs</li><li>Remove the structs in the model group</li></ul><p>Then, all the code that referenced the structs are now referencing the classes made by Core Data. You may need to do a clean (Product -&gt; Clean Build Folder) and build (Project -&gt; Build or CMD-B) of your project for it recognize the new classes.</p><p>In the next module, we'll look at how to interact with the database for deletions, storing, and fetching.</p><p style="float: left">Previous:  <A HREF="../06-NSManagedObjects/index.html">Making NSManagedObjects</A></p><p style="float: right">Next:  <A HREF="../08-StoringAndFetching/index.html" class="nextModule">Storing and Fetching</A></p></div><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2022-2023 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 16, 2023 at 2:38 PM</p><p><a href="https://twitter.com/hococoder" target="_blank">My Twitter</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://blackboard.jhu.edu" target="_blank">JHU Blackboard</a></p></footer></body></html>