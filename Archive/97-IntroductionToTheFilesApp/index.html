<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Mobile Application Development for the iOS Platform"/><link rel="canonical" href="https://hococoder.com/Archive/97-IntroductionToTheFilesApp"/><meta name="twitter:url" content="https://hococoder.com/Archive/97-IntroductionToTheFilesApp"/><meta name="og:url" content="https://hococoder.com/Archive/97-IntroductionToTheFilesApp"/><title>Week 8 - Exposing your App to the Files App | Mobile Application Development for the iOS Platform</title><meta name="twitter:title" content="Week 8 - Exposing your App to the Files App | Mobile Application Development for the iOS Platform"/><meta name="og:title" content="Week 8 - Exposing your App to the Files App | Mobile Application Development for the iOS Platform"/><meta name="description" content="A description of my first post."/><meta name="twitter:description" content="A description of my first post."/><meta name="og:description" content="A description of my first post."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="../../../styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Mobile Application Development for the iOS Platform"/></head><body><header><div class="wrapper"><a class="site-name" href="/">Mobile Application Development for the iOS Platform</a><nav><ul><li><a href="/epp_605_687_spring_2023/posts/Intro/About Me">AboutMe</a></li><li><a href="/epp_605_687_spring_2023/posts/Intro/Example App">ExampleApp</a></li><li><a href="/epp_605_687_spring_2023/posts/Week00/00-Week00Overview">Week0</a></li><li><a href="/epp_605_687_spring_2023/posts/Week01/00-Week01Overview">Week1</a></li><li><a href="/epp_605_687_spring_2023/posts/Week02/00-Week02Overview">Week2</a></li><li><a href="/epp_605_687_spring_2023/posts/Week03/00-Week03Overview">Week3</a></li><li><a href="/epp_605_687_spring_2023/posts/Week04/00-Week04Overview">Week4</a></li><li><a href="/epp_605_687_spring_2023/posts/Week05/00-Week05Overview">Week5</a></li><li><a href="/epp_605_687_spring_2023/posts/Week06/00-Week06Overview">Week6</a></li><li><a href="/epp_605_687_spring_2023/posts/Week07/00-Week07Overview">Week7</a></li><li><a href="/epp_605_687_spring_2023/posts/Week08/00-Week08Overview">Week8</a></li><li><a href="/epp_605_687_spring_2023/posts/Week09/00-Week09Overview">Week9</a></li><li><a href="/epp_605_687_spring_2023/posts/Week10/00-Week10Overview">Week10</a></li><li><a href="/epp_605_687_spring_2023/posts/Week11/00-Week11Overview">Week11</a></li><li><a href="/epp_605_687_spring_2023/posts/Week12/00-Week12Overview">Week12</a></li><li><a href="/epp_605_687_spring_2023/posts/Week13/00-Week13Overview">Week13</a></li><li><a href="/epp_605_687_spring_2023/posts/Week14/00-Week14Overview">Week14</a></li></ul></nav></div></header><div class="wrapper"><h1>Week 8 - Exposing your App to the Files App</h1><p style="float: left">Previous:  <A HREF="../Week08Overview/index.html">Week 8 Overview</A></p><p style="float: right">Next:  <A HREF="../UsingTheDocumentBrowser/index.html" class="nextModule">Using the Document Browser</A></p><BR/><BR/><h2>Overview</h2><p>Back in <A HREF="../../Week03/YourAppsDirectoryStructure/index.html">Week 3</A>, we talked briefly about the directory structure that sits below your app. In that discussion, it was noted that the Documents directory was the place to store, well, documents for your app, leaving other items such as temp files and data caches to their respective directories.</p><p>The benefit of a sandboxed system like this is that the data for your app is protected from the prying eyes of other apps on the system - one of the major benefits of iOS. But what if you wanted to get access to files in your app while you weren't in your app - and better yet, have an easy way to share those files with other apps on your system?</p><p>In iOS11, Apple introduced the Files App, which not only gives you access to file on your device that apps have made available, but also any files that you have stored in your iCloud account, as well as access to files stored in other cloud apps such as Box and Google Drive.</p><img src="../../../week08/FIlesApp.png#centerResizedSlide" alt="Files App"/><p>In this module, we'll cover how to update your app to make its documents directory files visible to the Files App, and in the next module, we'll cover how to integrate iOS' built in file document browser in your code.</p><h2>Updating your App for the Files App</h2><p>Updating your app so it is recognized by the Files app is pretty straight forward, so let's dive right into a demo:</p><center> <iframe width="1280" height="720" src="https://cdnapisec.kaltura.com/html5/html5lib/v2.81.2/mwEmbedFrame.php/p/1458241/uiconf_id/14487351/entry_id/1_d6x51iwb?wid=_1458241&iframeembed=true&playerId=kaltura_player&entry_id=1_d6x51iwb&flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[mediaProxy.preferedFlavorBR]=2500&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;flashvars[EmbedPlayer.NotPlayableDownloadLink]=true;&wid=1_abkvs1gz"allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0" title="Kaltura Player">
  </iframe>
</center><p>I've got a blank SwiftUI view. Let's build in some UI to save some text inputs to a file in the documents directory. Start by adding some state properties to track the notes you'll enter, the status of the save functionality, whether the save was successful, and the file path you'll save the data to.</p><pre><code><span class="keyword">@State var</span> notes: <span class="type">String</span> = <span class="string">""</span>
<span class="keyword">@State var</span> saveStatus: <span class="type">String</span> = <span class="string">"Ready"</span>
<span class="keyword">@State var</span> filePath: <span class="type">String</span> = <span class="string">""</span>
<span class="keyword">@State var</span> saveSuccessful = <span class="keyword">false</span>

</code></pre><p>Then, build a simple UI to allow the user to take some quick notes in a text field. Use a <code>TextField</code> to allow the user to enter single line text entries (SwiftUI in iOS 14 comes with a multiline editor; in iOS 13, you'd have to wrap UITextField from UIKit to get this functionality):</p><pre><code><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
  <span class="type">VStack</span> {
    <span class="type">Text</span>(<span class="string">"Note Taker"</span>).<span class="call">font</span>(.<span class="dotAccess">largeTitle</span>)
    <span class="type">Spacer</span>()
    <span class="type">Text</span>(<span class="string">"Use the space below to take notes and store them in the 'Notes.txt' file in this app's document directory"</span>).<span class="call">padding</span>(<span class="number">20</span>)
    <span class="type">TextField</span>(<span class="string">"Enter Notes Here"</span>, text: <span class="property">$notes</span>)
      .<span class="call">textFieldStyle</span>(<span class="type">RoundedBorderTextFieldStyle</span>())
      .<span class="call">frame</span>(height: <span class="number">100</span>).<span class="call">padding</span>(<span class="number">20</span>)
</code></pre><p>Include 2 buttons, one to save the notes to the file, and another to open the Files app. After those include a status text field to report whether the save was successful or not.</p><pre><code>     <span class="type">Button</span>(<span class="string">"Save Notes"</span>) {
      <span class="keyword">self</span>.<span class="call">saveNotes</span>()
    }.<span class="call">padding</span>(<span class="number">10</span>)
    <span class="type">Button</span>(<span class="string">"Open Files app"</span>) {
      <span class="keyword">self</span>.<span class="call">openFilesApp</span>()
    }.<span class="call">padding</span>(<span class="number">10</span>)
    <span class="keyword">if</span> (saveSuccessful) {
      <span class="type">Text</span>(saveStatus)
    }
    <span class="type">Spacer</span>()
  }
}
</code></pre><p>Now let's implement the 2 methods - one to save the file, the other to launch the Files App for us.</p><pre><code><span class="keyword">func</span> saveNotes() {
  
  <span class="keyword">let</span> docDirectory = <span class="type">FileManager</span>.<span class="property">default</span>.<span class="call">urls</span>(for: .<span class="dotAccess">documentDirectory</span>, in: .<span class="dotAccess">userDomainMask</span>).<span class="property">first</span>!
  <span class="keyword">self</span>.<span class="property">filePath</span> = docDirectory.<span class="property">path</span> + <span class="string">"/Notes.txt"</span>
  <span class="keyword">let</span> rawData = <span class="keyword">self</span>.<span class="property">notes</span>.<span class="call">data</span>(using: .<span class="dotAccess">utf8</span>)
  <span class="keyword">guard</span> <span class="type">FileManager</span>.<span class="property">default</span>.<span class="call">createFile</span>(atPath: filePath, contents: rawData, attributes: <span class="keyword">nil</span>) == <span class="keyword">true else</span> { <span class="keyword">self</span>.<span class="property">saveStatus</span> = <span class="string">"Error saving to file."</span>; <span class="call">fatalError</span>() }
  <span class="keyword">self</span>.<span class="property">saveStatus</span> = <span class="string">"Save successful"</span>
  <span class="keyword">self</span>.<span class="property">saveSuccessful</span> = <span class="keyword">true</span>
}
</code></pre><p>This code is similar to what you saw in week 3 - the path to the documents directory for this app is determined, and the full URL for the file you want to save is made. The <code>notes</code> string is turned into a <code>Data</code> object by using the string's <code>data</code> method, and we choose to encode it with <code>utf8</code> encoding.</p><p>Once that is complete you can save the file - the line that begins with the <code>guard</code> statement attempts to create a file on the system at the specified URL, inserting the <code>rawData</code> contents. The <code>else</code> clause makes a note if it fails and emits a fatal error; if the save was successful, some of our properties are updated in order to update the UI.</p><p>Now let's make another method to open the Files app.</p><pre><code><span class="keyword">func</span> openFilesApp() {
  <span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"shareddocuments://"</span> + <span class="keyword">self</span>.<span class="property">filePath</span>)!
  <span class="type">UIApplication</span>.<span class="property">shared</span>.<span class="call">open</span>(url, options: [:], completionHandler: <span class="keyword">nil</span>)
}
</code></pre><p>This uses the concept of URL schemes. If you desire, you can register a URL prefix, or scheme, with the OS that will allow other applications on the device to send data to your app via the URL. Here, we're prepending "shareddocuments://" to the front of the file path, which is the URL scheme for the Files app. Not only will this launch the Files app, it will open up the file we specify.</p><p>If we tried running this now, however, it would save the file in the documents directory, but we wouldn't be able to see it in the Files app. To do that, we need to enable a few entries in the app's Info.plist file. Add these</p><pre><code><span class="type">Application</span> supports iTunes file sharing = <span class="type">YES</span>
</code></pre><pre><code><span class="type">Supports</span> opening documents <span class="keyword">in</span> place = <span class="type">YES</span>
</code></pre><p>This will enable files to be viewed in the Files app if there are files in the app's documents directory. These 2 keys are the important parts here - without those entries set to YES, viewing files in the Files app for your app wouldn't work; the rest of the code was purely to help with the example.</p><p>Run this in the simulator, add some text, save the file, and then open the Files app via the button you added. This will open the file in the Files App - note that it's not editable here, just read only.</p><h2>Adding File Extension Support</h2><p>To make the application natively support different types of file extensions, you need to add some additional Info.plist entries. By adding these entries and their associated extensions, iOS will know that if a user wants to open a file of a given extension, <em>your</em> app will be one of the ones it can display in the Share Sheet.</p><img src="../../../week08/ShareSheet.png#centerResized" alt="Files App"/><p>To add support for additional file types, you can either add support to an existing app, like what we'll do here, or start your app with the "Document Based App" template, which will give you some preconfigured UI, as well as defaults support for images. Either way, you'll need to add entries to the Info.plist file if you want to add more support.</p><p>Let's add text file support. Go to the project's Info.plist, scroll down to the Document Types and expand it (if "Document Types" doesn't already exist as a Key, you can add it). Here you can add a new type. To add text, for example, you would set the following:</p><ul><li>"Document Type Name" to "text" (or something appropriate)</li><li>Handler rank to "Alternate" (this declares it as an alternate way to open text files, not the primary way, which we be specified with something like <code>Default</code> or <code>Owner</code>)</li><li>Add a new key under "Item 0" called "Document Content Type UTIs" and set the value to "public.plain-text". That section of the Info.plist should look like this:</li></ul><img src="../../../week08/DocumentTypes.png#centerResized" alt="Files App"/><p>Wondering where that <code>type</code> came from? You can see a list of system wide universal type identifiers <a href=" https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html">here</a>. This should help you track down the type for the extension you want to support. Here are a few of those identifiers:</p><table><thead><tr><th align="left">Extension</th><th align="center">Type</th></tr></thead><tbody><tr><td align="left">text</td><td align="center">public.plain-text</td></tr><tr><td align="left">zip</td><td align="center">public.zip-archive</td></tr><tr><td align="left">gzip</td><td align="center">org.gnu.gnu-zip-archive</td></tr><tr><td align="left">tgz</td><td align="center">org.gnu.gnu-zip-tar-archive</td></tr></tbody></table><p>Adding support for extensions this way, enables files with these extensions to have "EPGradeBook" appear in the Share Sheet's "Open With" pane (the image above shows this).</p><p style="float: left">Previous:  <A HREF="../Week07Overview/index.html">Week 7 Overview</A></p><p style="float: right">Next:  <A HREF="../UsingTheDocumentBrowser/index.html" class="nextModule">Using the Document Browser</A></p></div><footer><p>Generated with ❤️ using <a href="https://github.com/johnsundell/publish">Publish</a></p><p>© 2022-2023 Josh Steele (rsteele3@jhu.edu) <a href="mailto:"(rsteele3@jhu.edu)""></a></p><p>Last updated January 16, 2023 at 2:38 PM</p><p><a href="https://twitter.com/hococoder" target="_blank">My Twitter</a> | <a href="https://github.com/hococoder" target="_blank">My GitHub</a> | <a href="https://ep.jhu.edu" target="_blank">Whiting School EPP</a> | <a href="https://blackboard.jhu.edu" target="_blank">JHU Blackboard</a></p></footer></body></html>